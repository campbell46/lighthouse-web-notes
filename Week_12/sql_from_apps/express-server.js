///////////////////////////////////////////////////////////////////////
// Packages
///////////////////////////////////////////////////////////////////////

// npm i express morgan nodemon pg dotenv

const express = require('express');
const morgan = require('morgan');

///////////////////////////////////////////////////////////////////////
// Helpers
///////////////////////////////////////////////////////////////////////

const { getAllVillains, getVillain } = require('./data/villain-queries');

///////////////////////////////////////////////////////////////////////
// Express / Config
///////////////////////////////////////////////////////////////////////

const PORT = 8080;
const app = express();

///////////////////////////////////////////////////////////////////////
// Middleware
///////////////////////////////////////////////////////////////////////

app.use(morgan('dev'));

///////////////////////////////////////////////////////////////////////
// Listener
///////////////////////////////////////////////////////////////////////

app.listen(PORT, () => {
    console.log(`Express app listening on: http://localhost:${PORT}`);
});

///////////////////////////////////////////////////////////////////////
// Routes
///////////////////////////////////////////////////////////////////////

/**
 * Homepage
 */
app.get('/', (req, res) => {
    res.end('Hello, World!');
});

/**
 * Villains index
 */
app.get('/villains', (req, res) => {
    getAllVillains()
        .then((rows) => {
            res.json(rows);
        });
});

/**
 * Villain show
 */
 app.get('/villains/:id', (req, res) => {
    const id = req.params.id;
    getVillain(id)
        .then((row) => {
            res.json(row);
        })
        .catch((error) => {
            res.status(404);
            res.json({error: 'Villain not found.'});
        });
});
